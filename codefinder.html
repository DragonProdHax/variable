<iframe id="launcher" src="https://play.prodigygame.com/launcher" style="position:fixed; top:0; left:0; bottom:0; right:0; width:100%; height:100%; border:none; margin:0; padding:0; overflow:hidden; z-index:999999;">
    Your browser doesn't support iframes
</iframe>

<script>
    try {
        fetch("https://sso.prodigygame.com/premises?premises=home", {
            "headers": {
                "accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7",
            },
            "body": "",
            "method": "POST",
            "mode": "cors"
        });
    } catch (e) {
        console.error(e);
    }

    var launcher = document.getElementById("launcher");

    launcher.onload = async function(e) {
        if (launcher.contentWindow.location.host == 'math.prodigygame.com') {
            try {
                // Fetch the Base64-encoded hijacker code
                var hijackercode = await (await fetch("https://raw.githubusercontent.com/DragonProdHax/variable/refs/heads/main/index.html")).text();

                // Decode the Base64 content
                hijackercode = atob(hijackercode);

                // Extract the game file URL
                window.opener.gamecodeurl = launcher.contentDocument.querySelector('script#gameFile').src;

                // Inject the decoded code into the opener document
                if (window.opener.history.pushState) {
                    window.opener.document.open();
                    window.opener.document.write(hijackercode);
                    window.opener.document.close();
                    window.close();
                }
            } catch (e) {
                console.error(e);
            }
        }
    };
</script>
